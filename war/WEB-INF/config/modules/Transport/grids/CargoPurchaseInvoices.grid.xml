<?xml version="1.0" encoding="UTF-8"?>
<g:Grid xmlns="http://www.butent.com/column" xmlns:g="http://www.butent.com/grid"
        xmlns:ui="http://www.butent.com/ui"

        name="CargoPurchaseInvoices" viewName="CargoPurchaseInvoices"
        editShowId="true" flexGrow="1"
        disabledActions="add"
        caption="=trPurchaseInvoices"
        filter="Purchase"
>
  <g:columns>
    <SelectionColumn name="Select" width="20" />
    <IdColumn name="ID" caption="=trdInvoiceId" />
    <DataColumn name="Date" />
    <DataColumn name="Number" />
    <RelColumn name="OperationName" filterSupplier="list" />

    <DataColumn name="InvoiceNo" searchBy="InvoicePrefix InvoiceNo">
      <renderToken source="InvoicePrefix" suffix=" " />
      <renderToken source="InvoiceNo" />
    </DataColumn>
    <RelColumn name="Supplier" filterSupplier="value" />
    <DataColumn name="Amount" />
    <DataColumn name="CurrencyName" filterSupplier="list" />

    <PropColumn name="Vat" type="decimal" caption="PVM suma" format="#.##" />
    <PropColumn name="WithoutVat" type="decimal" caption="Be PVM" format="#.##"
                horizontalAlignment="right">
      <render>
        <ui:function>
          if (row.Vat) {
          return Math.round((row.Amount - row.Vat) * 100) / 100;
          } else {
          return row.Amount;
          }
        </ui:function>
      </render>
    </PropColumn>

    <DataColumn name="Term" />

    <DataColumn name="PaymentTime" />
    <DataColumn name="Paid" />
    <DataColumn name="Debt" format="0.00" />

    <RelColumn name="Manager" renderColumns="ManagerFirstName ManagerLastName" filterSupplier="list" />

    <DataColumn name="Exported" />

    <DataColumn name="NewNumber" />

    <CalcColumn name="Order" type="string" caption="=orderNumber" maxWidth="300">
      <render>
        <ui:function>
          if (!row.MinOrder) {
          return row.MaxOrder;

          } else if(!row.MaxOrder || row.MinOrder == row.MaxOrder) {
          return row.MinOrder;

          } else {
          return row.MinOrder + ", " + row.MaxOrder + (row.CntOrder > 2 ? ", ...": "");
          }
        </ui:function>
      </render>
    </CalcColumn>
  </g:columns>

  <g:rowStyle>
    <ui:inline>="color:red"</ui:inline>
    <ui:expression>row.Debt &gt; 0 &amp;&amp; row.Term &lt; new Date().getTime()</ui:expression>
  </g:rowStyle>
  <g:rowStyle>
    <ui:inline>="color:green"</ui:inline>
    <ui:expression>row.Debt == 0</ui:expression>
  </g:rowStyle>
</g:Grid>
