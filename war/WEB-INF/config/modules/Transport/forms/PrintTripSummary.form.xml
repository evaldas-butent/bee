<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE Form [
    <!ENTITY form "PrintTripSummary">
    ]>
<f:Form xmlns="http://www.butent.com/widget"
        xmlns:f="http://www.butent.com/form"
        xmlns:ui="http://www.butent.com/ui"

        name="&form;" caption="Reiso suvestinė" disabledActions="save"
        width="70" widthUnit="%" height="90" heightUnit="%"
    >

  <FlowPanel class="bee-PrintableForm" style="font-family:Arial;">
    <css id="&form;">
      .&form;-table {border-collapse:collapse; page-break-inside:avoid;}
      .&form;-table td {border:1px solid black; padding:2px;}

      .&form;-table .Number .bee-Label:before {content:"Dok.Nr.";}
      .&form;-table .Date .bee-Label:before {content:"Data";}
      .&form;-table .Item .bee-Label:before {content:"Išlaidų turinys";}
      .&form;-table .Driver .bee-Label:before {content:"Vairuotojas";}
      .&form;-table .Quantity .bee-Label:before {content:"Kiekis";}
      .&form;-table .Unit .bee-Label:before {content:"Mato v.";}
      .&form;-table .Price .bee-Label:before {content:"Kaina";}
      .&form;-table .Amount .bee-Label:before {content:"Suma";}
      .&form;-table .Remainder .bee-Label:before {content:"Likutis";}

      .&form;-table .Quantity, .&form;-table .Price, .&form;-table .Amount, .&form;-table .Remainder {text-align:right;}
      .&form;-table .header {text-align:center;}
      .&form;-table .footer {font-weight:bold;}
    </css>

    <Image url="images/hop_header.jpg" style="display:block; margin:auto;" />

    <Label html="KOMANDIRUOTĖS ATASKAITA - IŠLAIDŲ SUVESTINĖ"
           style="text-align:center; font-weight:bold;" />

    <TextLabel source="TripNo" style="text-align:center; font-weight:bold;" />
    <br />

    <Table kind="output" style="width:100%">
      <col index="0" style="width:30%;" />
      <row>
        <Label text="Pagrindinis vairuotojas" />
        <TextLabel source="DriverName" />
      </row>
      <row>
        <Label text="Antras vairuotojas" />
        <Label name="TripDriversAll" />
      </row>
      <row>
        <Label for="Route" />
        <TextLabel source="Route" />
      </row>
      <row>
        <Label for="Vehicle" />
        <TextLabel source="VehicleNumber" />
      </row>
      <row>
        <Label for="Trailer" />
        <TextLabel source="TrailerNumber" />
      </row>
    </Table>

    <br />

    <Label text="1. Kelionės lapo informacija:" style="font-weight:bold;" />

    <Table kind="output" class="&form;-table" style="text-align:center;">
      <col index="0" cellStyle="text-align:left;" />
      <row>
        <text />
        <Label text="=transportDeparture" />
        <Label text="=transportArrival" />
        <Label text="=total" />
      </row>
      <row>
        <Label text="=date" />
        <DateLabel source="DateFrom" />
        <DateLabel source="DateTo" />
        <TextLabel>
          <render>
            <ui:expression>
              row.DateFrom &amp;&amp; row.DateTo ? (Math.floor((row.DateTo - row.DateFrom) / (1000 * 24 * 3600)) + 1) : ''
            </ui:expression>
          </render>
        </TextLabel>
      </row>
      <row>
        <Label text="=transportSpeedometer" />
        <TextLabel source="SpeedometerBefore" />
        <TextLabel source="SpeedometerAfter" />
        <TextLabel>
          <render>
            <ui:function>
              if ((row.SpeedometerBefore || row.SpeedometerBefore == 0)
              &amp;&amp; (row.SpeedometerAfter || row.SpeedometerAfter == 0)) {
                var difference = row.SpeedometerAfter - row.SpeedometerBefore;

                if (difference &lt; 0) {
                  var maxValue = Math.pow(10, Math.floor(row.SpeedometerBefore).toString().length);
                  difference = maxValue + difference;
                }
                return difference;
              }
              return "";
            </ui:function>
          </render>
        </TextLabel>
      </row>
      <row>
        <Label text="=transportFuelBalanceInTank" />
        <TextLabel source="FuelBefore" />
        <TextLabel source="FuelAfter" />
        <FlowPanel style="text-align:left;">
          <FlowPanel class="flexBox-horizontal">
            <Label class="flexible" text="Sunaudota kuro, l" />
            <Label name="Fuel" style="margin-left:1em;" />
          </FlowPanel>
          <FlowPanel class="flexBox-horizontal">
            <Label class="flexible" text="Sunaudoto kuro suma" />
            <Label name="TripFuelCosts" style="margin-left:1em;" />
          </FlowPanel>
          <FlowPanel class="flexBox-horizontal">
            <Label class="flexible" text="Kuro sąnaudos l/100km" />
            <Label name="TripFuelConsumptions" style="margin-left:1em;" />
          </FlowPanel>
        </FlowPanel>
      </row>
    </Table>

    <br />
    <Label text="2. Kompensuotinos išlaidos" style="font-weight:bold;" />
    <FlowPanel name="DriverCosts" class="&form;-table" />

    <br />
    <Label text="3. Kitos REISO išlaidos iš įmonės lėšų (atsiskaitymas ne grynais pinigais)"
           style="font-weight:bold;" />
    <FlowPanel name="OtherCosts" class="&form;-table" />

    <br />
    <Label text="4. REISO IŠLAIDŲ SUVESTINĖ" style="font-weight:bold;" />
    <Table kind="output" class="&form;-table">
      <row>
        <Label text="Kompensuotinos išlaidos (2)" />
        <Label name="DriverCostsTotal" class="Amount" />
      </row>
      <row>
        <Label text="Kitos REISO išlaidos iš įmonės lėšų (atsiskaitymas ne grynais pinigais) (3)" />
        <Label name="OtherCostsTotal" class="Amount" />
      </row>
      <row>
        <Label text="VISO REISO IŠLAIDOS" class="footer" />
        <Label name="CostsTotal" class="Amount footer" />
      </row>
    </Table>

    <br />
    <Label text="5. Reiso atsiskaitymo suvestinė pagal darbuotojus" style="font-weight:bold;" />
    <FlowPanel name="DriverAdvances" class="&form;-table" />

    <br />

    <Label text="Kita, papildoma informacija:" />
    <hr style="border-top:1px solid black; border-bottom:0; margin-top:20px;" />
    <hr style="border-top:1px solid black; border-bottom:0; margin-top:20px;" />
    <hr style="border-top:1px solid black; border-bottom:0; margin-top:20px;" />

    <br />

    <Label text="Komandiruotės ataskaitą - išlaidų suvestinę sutikrino ir atspausdino" />

    <br />

    <Table kind="output" style="width:100%">
      <col index="1" cellStyle="text-align:right;" />
      <row>
        <Label name="User" />
        <text>____________________________________</text>
      </row>
      <row>
        <Label text="=date" />
        <TextLabel>
          <render>
            <ui:expression>new Date().toLocaleDateString()</ui:expression>
          </render>
        </TextLabel>
      </row>
    </Table>
  </FlowPanel>
</f:Form>