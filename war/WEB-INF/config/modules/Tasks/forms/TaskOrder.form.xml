<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE Form [
    <!ENTITY inline "display: inline-block;">
    <!ENTITY section "margin-top: 2px;">
    <!ENTITY tbl "border-collapse: collapse;">
    <!ENTITY cell "padding-bottom: 2px;">
    <!ENTITY col1 "text-align: right; padding-right: 8px; width: 128px;">
    <!ENTITY col3 "text-align: right; padding-left: 8px; padding-right: 8px; width: 128px;">

    <!ENTITY top1 "float: left; width: 100px; padding-top: 1px;">

    <!ENTITY inp2 "width: 160px;">
    <!ENTITY inp2x "&inline; width: 500px;">
    <!ENTITY inp3 "width: 70px;margin-left: -75px">

    <!ENTITY dateStyle "&inline; min-width: 90px; max-width: 90px;">
    <!ENTITY timeStyle "&inline; min-width: 60px; max-width: 60px; width: 60px; margin-left: 10px;">
    <!ENTITY timeStep "30">
    <!ENTITY forProject "<dynStyle><ui:inline>display: none;</ui:inline><ui:expression>!row.Project</ui:expression></dynStyle>">
    ]>
<f:Form xmlns="http://www.butent.com/widget"
        xmlns:f="http://www.butent.com/form"
        xmlns:ui="http://www.butent.com/ui"
        xmlns:xi="http://www.w3.org/2001/XInclude"

        name="TaskOrder" viewName="TaskOrders" caption="=order" showRowId="true" printHeader="true"
        width="1024" height="768" favorite="Summary"
>
  <f:properties jasperReports="Task_lt:Užsakymas, TaskRemake_lt:Užsakymas2, InternalTask_lt:Vidinis užsakymas" />
  <SplitPanel splitterSize="1" style="margin:5px;" name="Split" >
    <west size="660">
      <TabbedPages resizable="false" name="TabbedPages" >
        <page>
          <text>=mainInformation</text>

          <FlowPanel class="flexBox-horizontal bee-crm-taskEdit-form">
            <FlowPanel name="TaskContainer" style="margin-left: 5px; overflow:scroll; min-width:650px;">
              <Table kind="controls" style="&tbl;" cellStyle="&cell;">
                <col index="0" cellStyle="&col1;" />

                <row>
                  <Label for="Summary" />
                  <InputText source="Summary" style="&inp2x;" autocomplete="true" visible="true"
                               maxLength="70" />
                </row>

                <row>
                  <Label text="=files" />
                  <FlowPanel class="flexBox-horizontal-top" data="TaskFiles">
                    <FileGroup name="Files" data="TaskFiles" visibleColumns="icon name size createdoc"/>
                  </FlowPanel>
                </row>

                <row>
                  <Label for="OrderNo" />
                  <InputText source="OrderNo" />
                </row>
              </Table>

              <Table kind="controls" style="&tbl;" cellStyle="&cell;">
                <col index="0" cellStyle="&col1;" />

                <row>
                  <Label for="Owner" />
                  <DataSelector source="Owner" editSource="OwnerPerson" style="&inp2x;"/>
                </row>

                <row>
                  <Label for="Executor" />
                  <DataSelector source="Executor" editSource="ExecutorPerson" style="&inp2x;"
                                readOnly="true" />
                </row>

                <row>
                  <Label text="=crmTaskObservers" />
                  <MultiSelector name="Observers" viewName="Users" property="Observers" renderColumns="FirstName LastName"
                                 editSource="CompanyPerson" newRowEnabled="false" style="&inp2x;" disablable="true"
                                 label="=crmTaskObservers" />
                </row>
              </Table>

              <Table kind="controls" style="&tbl;" cellStyle="&cell;" >
                <col index="0" cellStyle="&col1;" />

                <row>
                  <Label for="Company" />
                  <DataSelector source="Company" editPopup="true" newRowEnabled="true" choiceColumns="Name TypeName"
                                renderColumns="CompanyName CompanyTypeName" style="&inp2x;" />
                </row>

                <row>
                  <Label for="Contact" />
                  <DataSelector source="Contact" editPopup="true" newRowEnabled="true" style="&inp2x;"
                                renderColumns="ContactFirstName ContactLastName"
                                choiceColumns="FirstName LastName CompanyName" options="Company" />
                </row>

                <row>
                  <Label for="Type" />
                  <DataSelector source="Type" name="Type" renderColumns="TypeName"
                                newRowEnabled="true" style="&inp2x;" disablable="true" />
                </row>
              </Table>

              <Table kind="controls" style="&tbl;" cellStyle="&cell;">
                <col index="0" cellStyle="&col1;" />
                <col index="2" cellStyle="&col1;" />

                <row>
                  <Label for="StartTime" />
                  <InputDateTime source="StartTime" style="&inp2;" readOnly="true" visible="true" />

                  <Label for="FinishTime" />
                  <FlowPanel class="flexBox-horizontal">
                    <InputDateTime source="FinishTime" style="&inp2;" readOnly="true" />
                    <TextLabel name="LateIndicator" style="&inp2; margin-left: -160px" >
                      <dynStyle>
                        <ui:class>bee-crm-task-break</ui:class>
                        <ui:expression>
                          row.Status == 3 || row.Status == 4 || row.Status == 5 || row.Status == 6
                        </ui:expression>
                      </dynStyle>

                      <dynStyle>
                        <ui:class>bee-crm-task-progress</ui:class>
                        <ui:expression>
                          !(row.Status == 3 || row.Status == 4 || row.Status == 5 || row.Status == 6)
                        </ui:expression>
                      </dynStyle>
                    </TextLabel>
                  </FlowPanel>
                </row>

                <row>
                  <br />
                  <br />
                  <br />
                  <FlowPanel name="TaskExtensions" style="&inp2;" />
                </row>
              </Table>
              <FlowPanel name="TaskDurations" data="TaskDurations"
                         style="overflow: auto; width: 524px; margin-top: 10px;" />

              <xi:include href="widgets/TaskOrder.widget.xml" />

              <Disclosure open="false" style="margin-top: 2ex;" >
                <Label text="PAPILDOMA INFORMACIJA" />
                <FlowPanel>
                  <Table kind="controls" style="&tbl;" cellStyle="&cell;" >
                    <col index="0" cellStyle="&col1;" />

                    <row>
                      <Label for="Priority" />
                      <Radio source="Priority" />
                    </row>

                    <row>
                      <Label for="Status" />
                      <ListBox source="Status" style="&inp2;" readOnly="true" visible="true" />
                    </row>

                    <row>
                      <Label for="Product" name="Product" />
                      <DataSelector source="Product" renderColumns="ProductName" newRowEnabled="true"
                                    style="&inp2x;" filter="Visible" />
                    </row>

                    <row>
                      <Label text="=project">
                        &forProject;
                      </Label>
                      <DataSelector source="Project" renderColumns="ProjectName"
                                    style="&inp2x;" disablable="true" readOnly="true">
                        &forProject;
                      </DataSelector>
                    </row>
                    <row>
                      <Label text="=prjStage">
                        &forProject;
                      </Label>
                      <DataSelector source="ProjectStage" renderColumns="StageName"
                                    style="&inp2x;">
                        &forProject;
                      </DataSelector>
                    </row>
                  </Table>

                  <Table kind="controls" style="&tbl;" cellStyle="&cell;">
                    <col index="0" cellStyle="&col1;" />
                    <col index="2" cellStyle="&col3;" />

                    <row>
                      <Label for="ExpectedDuration" />
                      <InputTime name="ExpectedDuration" source="ExpectedDuration" step="&timeStep;" style="width: 90px;" />
                      <Label for="ExpectedExpenses" />
                      <FlowPanel>
                        <InputDecimal source="ExpectedExpenses" style="&dateStyle;" disablable="true" scale="2"/>
                        <DataSelector source="Currency" for="ExpectedExpenses" newRowEnabled="false" editEnabled="false"
                                      style="&timeStyle;" readOnly="true" />
                      </FlowPanel>
                    </row>

                    <row>
                      <Label />
                      <CheckBox name="Mail" text="=mailNotify" />
                      <Label />
                      <CheckBox source="PrivateTask" />
                    </row>
                  </Table>
                </FlowPanel>
              </Disclosure>

              <Disclosure open="false" style="margin-top: 2ex;" >
                <Label text="SUSIJUSI SU" />
                <Relations name="Relations" relColumn="Task" inline="true"
                           disablable="false" style="&section; width: 500px;" summarize="true"
                           defaultRelations="Companies Persons Documents Appointments Discussions
                       Projects Tasks Requests Messages">
                  <Relation viewName="Companies" renderColumns="Name TypeName"
                            newRowEnabled="false" editPopup="true"/>
                  <Relation viewName="Persons" renderColumns="FirstName LastName"
                            newRowEnabled="false" editPopup="true"/>
                  <Relation viewName="Documents"
                            renderColumns="Name Number RegistrationNumber DocumentDate"
                            newRowEnabled="false" editPopup="true"/>
                  <Relation viewName="Discussions" renderColumns="Subject"
                            newRowEnabled="false" editPopup="true"/>
                  <Relation viewName="ServiceObjects" renderColumns="Model CategoryName ArticleNo"
                            newRowEnabled="false" editPopup="true" choiceColumns="Model CategoryName ArticleNo"/>
                  <Relation viewName="Tasks"
                            renderColumns="Id Summary ExecutorFirstName ExecutorLastName"
                            newRowEnabled="false" editPopup="true"
                            choiceColumns="Id Summary ExecutorFirstName ExecutorLastName StartTime
                         FinishTime"/>
                  <Relation viewName="OrderCargo"
                            renderColumns="Description" newRowEnabled="false" editPopup="true" />
                  <Relation viewName="ServiceMaintenance"
                            renderColumns="ID" choiceColumns="ID TypeName StateName"
                            newRowEnabled="false" editPopup="true" />
                </Relations>
              </Disclosure>
            </FlowPanel>
          </FlowPanel>
        </page>
      </TabbedPages>
    </west>
    <center>
      <FlowPanel name="TaskEvents" data="TaskEvents" class="flexible bee-crm-taskEvent-container"
                 style="overflow: auto; height: calc(100% - 5px);" />
    </center>
  </SplitPanel>
  <f:rowMessage>
    <ui:expression>row.Summary</ui:expression>
  </f:rowMessage>
</f:Form>